<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.exercise.traffic_accidents.mapper.AccidentMapper">

    <sql id="selectPhrase">
        objt_id,
        occu_year,
        occu_mt,
        occu_de,
        occu_tm,
        occu_day,
        occu_date,
        lclas,
        sclas,
        death,
        swpsh,
        sinjpsn,
        injpsn,
        drnkg,
        kid,
        odsn,
        wlkg,
        violt_cn,
        ctprvn_cd,
        sgg_cd,
        emd_cd,
        x,
        y,
        geometry
    </sql>

    <sql id="wherePhrase">
        <where>
            <if test="isTimeSlot == true">
                <!-- 시간대 검색 -->
            </if>
            <if test="isTimeSlot != true">
                <if test="startDate != null and startDate != ''">
                    AND occu_date <![CDATA[ >= ]]> #{startDate}
                </if>
            </if>
            <if test="injuryTypes != null and injuryTypes.size > 0">
                AND lclas IN
                <foreach collection="injuryTypes" item="injury" open="(" separator="," close=")">
                    #{injury}
                </foreach>
            </if>
            <if test="accidentTypes != null and accidentTypes.size >0">
                AND sclas IN
                <foreach collection="accidentTypes" item="type" open="(" separator="," close=")">
                    #{type}
                </foreach>
            </if>
        </where>
    </sql>

    <sql id="orderByPhrase">
        ORDER BY occu_date DESC
    </sql>

    <select id="getTrafficAccidentList" parameterType="TrafficAccidentInfo" resultType="TrafficAccidentInfo">
        <!-- <include refid="paging.head" /> -->
            SELECT
                ROW_NUMBER() OVER (<include refid="orderByPhrase"/>) ROW_NUM,
                objt_id,
                occu_date,
                lclas,
                death,
                swpsn,
                sinjpsn
            FROM
                traffic_accident
            <include refid="wherePhrase"/>
        <!-- <include refid="paging.foot" /> -->
    </select>

</mapper>